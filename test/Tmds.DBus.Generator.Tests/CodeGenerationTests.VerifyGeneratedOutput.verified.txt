// Generated by Tmds.DBus.Generator v0.90.2
// <auto-generated/>
#nullable enable
namespace TestNamespace
{
    using System;
    using Tmds.DBus.Protocol;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    interface ICalculatorProperties
    {
        double? LastResult { get; }
        ObjectPath? CurrentPath { get; }
        bool HasLastResultChanged { get; }
        bool HasCurrentPathChanged { get; }
        bool AreAllPropertiesSet();
        CalculatorProperties EnsureAllPropertiesSet();
    }
    sealed class CalculatorProperties : ICalculatorProperties
    {
        private uint __set;
        private uint __invalidated;
        private const uint PropertiesAllSet = 0x3U; // 2 properties
        private static uint Flag(CalculatorProperty property) => property == 0 ? 0 : 1U << ((int)property - 1);
        public CalculatorProperties() { }
        #nullable disable
        [System.Diagnostics.CodeAnalysis.SetsRequiredMembers]
        private CalculatorProperties(bool _) { }
        #nullable enable
        private void EnsureSet(CalculatorProperty property)
        {
            if (!HasFlag(__set, property))
            {
                throw new InvalidOperationException("Property is not set.");
            }
        }
        private double _lastResult = default!;
        public required double LastResult
        {
            get { EnsureSet(CalculatorProperty.LastResult); return _lastResult; }
            set { _lastResult = value; __set |= Flag(CalculatorProperty.LastResult); }
        }
        private ObjectPath _currentPath = default!;
        public required ObjectPath CurrentPath
        {
            get { EnsureSet(CalculatorProperty.CurrentPath); return _currentPath; }
            set { _currentPath = value; __set |= Flag(CalculatorProperty.CurrentPath); }
        }
        double? ICalculatorProperties.LastResult
            => IsSet(CalculatorProperty.LastResult) ? _lastResult : default(double?);
        ObjectPath? ICalculatorProperties.CurrentPath
            => IsSet(CalculatorProperty.CurrentPath) ? _currentPath : default(ObjectPath?);
        bool ICalculatorProperties.HasLastResultChanged
            => IsSet(CalculatorProperty.LastResult) || IsInvalidated(CalculatorProperty.LastResult);
        bool ICalculatorProperties.HasCurrentPathChanged
            => IsSet(CalculatorProperty.CurrentPath) || IsInvalidated(CalculatorProperty.CurrentPath);
        CalculatorProperties ICalculatorProperties.EnsureAllPropertiesSet()
        {
            EnsureAllPropertiesSet();
            return this;
        }
        public static CalculatorProperties CreateUninitialized() => new CalculatorProperties(false);
        private bool HasFlag(uint flags, CalculatorProperty property)
            => property != 0 && (flags & Flag(property)) != 0;
        [System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.AggressiveInlining)]
        private static CalculatorProperty ParsePropertyName(string propertyName)
        {
            return propertyName switch
            {
                "LastResult" => CalculatorProperty.LastResult,
                "CurrentPath" => CalculatorProperty.CurrentPath,
                _ => 0
            };
        }
        private bool IsSet(CalculatorProperty property) => HasFlag(__set, property);
        private bool IsInvalidated(CalculatorProperty property) => HasFlag(__invalidated, property);
        private void SetInvalidated(CalculatorProperty property)
        {
            if (property != 0)
            {
                __invalidated |= Flag(property);
            }
        }
        [System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.AggressiveInlining)]
        public void SetInvalidated(string propertyName) => SetInvalidated(ParsePropertyName(propertyName));
        public bool AreAllPropertiesSet() => __set == PropertiesAllSet;
        public void EnsureAllPropertiesSet()
        {
            if (!AreAllPropertiesSet())
            {
                throw new DBusUnexpectedValueException($"Not all properties have been set (0x{__set:x}).");
            }
        }
        public static ICalculatorProperties ReadFrom(ref Reader reader, bool withInvalidated)
        {
            var props = CreateUninitialized();
            ArrayEnd arrayEnd = reader.ReadArrayStart(DBusType.Struct);
            while (reader.HasNext(arrayEnd))
            {
                var property = reader.ReadString();
                switch (property)
                {
                    case "LastResult":
                        reader.ReadSignature("d"u8);
                        props.LastResult = reader.ReadDouble();
                        break;
                    case "CurrentPath":
                        reader.ReadSignature("o"u8);
                        props.CurrentPath = reader.ReadObjectPath();
                        break;
                    default:
                        reader.ReadVariantValue();
                        break;
                }
            }
            if (withInvalidated)
            {
                ArrayEnd invalidatedEnd = reader.ReadArrayStart(DBusType.String);
                while (reader.HasNext(invalidatedEnd))
                {
                    var propertyName = reader.ReadString();
                    props.__invalidated |= propertyName switch
                    {
                        "LastResult" => Flag(CalculatorProperty.LastResult),
                        "CurrentPath" => Flag(CalculatorProperty.CurrentPath),
                        _ => 0
                    };
                }
            }
            return props;
        }
        private enum CalculatorProperty
        {
            UnknownProperty = 0,
            LastResult = 1,
            CurrentPath = 2
        }
    }
    sealed partial class Calculator : Tmds.DBus.Protocol.DBusObject
    {
        public const string DBusInterfaceName = "org.example.Calculator";
        public Calculator(Tmds.DBus.Protocol.DBusConnection connection, string destination, ObjectPath path)
            : base(connection, destination, path)
        { }
        public Task ClearAsync()
        {
            return Connection.CallMethodAsync(CreateMessage());
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    member: "Clear");
                return writer.CreateMessage();
            }
        }
        public Task<double> GetResultAsync()
        {
            return Connection.CallMethodAsync(CreateMessage(), (Message m, object? s) => MessageReader.Read_d(m), this);
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    member: "GetResult");
                return writer.CreateMessage();
            }
        }
        public Task<(uint Count, double Total)> GetStatsAsync()
        {
            return Connection.CallMethodAsync(CreateMessage(), (Message m, object? s) => MessageReader.Read_ud(m), this);
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    member: "GetStats");
                return writer.CreateMessage();
            }
        }
        public Task StoreAsync(double value)
        {
            return Connection.CallMethodAsync(CreateMessage());
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    signature: "d",
                    member: "Store");
                writer.WriteDouble(value);
                return writer.CreateMessage();
            }
        }
        public Task<double> SquareAsync(double input)
        {
            return Connection.CallMethodAsync(CreateMessage(), (Message m, object? s) => MessageReader.Read_d(m), this);
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    signature: "d",
                    member: "Square");
                writer.WriteDouble(input);
                return writer.CreateMessage();
            }
        }
        public Task<(int Quotient, int Remainder)> DivModAsync(int dividend)
        {
            return Connection.CallMethodAsync(CreateMessage(), (Message m, object? s) => MessageReader.Read_ii(m), this);
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    signature: "i",
                    member: "DivMod");
                writer.WriteInt32(dividend);
                return writer.CreateMessage();
            }
        }
        public Task LogOperationAsync(string operation, double value)
        {
            return Connection.CallMethodAsync(CreateMessage());
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    signature: "sd",
                    member: "LogOperation");
                writer.WriteString(operation);
                writer.WriteDouble(value);
                return writer.CreateMessage();
            }
        }
        public Task<double> AddAsync(double a, double b)
        {
            return Connection.CallMethodAsync(CreateMessage(), (Message m, object? s) => MessageReader.Read_d(m), this);
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    signature: "dd",
                    member: "Add");
                writer.WriteDouble(a);
                writer.WriteDouble(b);
                return writer.CreateMessage();
            }
        }
        public Task<(bool Equal, double Difference)> CompareAsync(double a, double b)
        {
            return Connection.CallMethodAsync(CreateMessage(), (Message m, object? s) => MessageReader.Read_bd(m), this);
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    signature: "dd",
                    member: "Compare");
                writer.WriteDouble(a);
                writer.WriteDouble(b);
                return writer.CreateMessage();
            }
        }
        public ValueTask<IDisposable> WatchResetAsync(Action<Exception?> handler, bool emitOnCapturedContext = true, ObserverFlags flags = ObserverFlags.None)
            => Connection.WatchSignalAsync(Destination, Path, DBusInterfaceName, "Reset", handler, this, emitOnCapturedContext, flags);
        public ValueTask<IDisposable> WatchErrorAsync(Action<Exception?, string> handler, bool emitOnCapturedContext = true, ObserverFlags flags = ObserverFlags.None)
            => Connection.WatchSignalAsync(Destination, Path, DBusInterfaceName, "Error", (Message m, object? s) => MessageReader.Read_s(m), handler, this, emitOnCapturedContext, flags);
        public ValueTask<IDisposable> WatchOperationCompleteAsync(Action<Exception?, (string Operation, double Result)> handler, bool emitOnCapturedContext = true, ObserverFlags flags = ObserverFlags.None)
            => Connection.WatchSignalAsync(Destination, Path, DBusInterfaceName, "OperationComplete", (Message m, object? s) => MessageReader.Read_sd(m), handler, this, emitOnCapturedContext, flags);
        public Task<double> GetLastResultAsync()
            => Connection.CallMethodAsync(CreateGetPropertyMessage("LastResult"), (Message m, object? s) => MessageReader.Read_v_d(m), this);
        public Task<ObjectPath> GetCurrentPathAsync()
            => Connection.CallMethodAsync(CreateGetPropertyMessage("CurrentPath"), (Message m, object? s) => MessageReader.Read_v_o(m), this);
        public async Task<ICalculatorProperties> GetPropertiesAsync()
        {
            var props = await Connection.CallMethodAsync(CreateGetAllPropertiesMessage(), (Message m, object? s) => ReadMessage(m), this).ConfigureAwait(false);
            props.EnsureAllPropertiesSet();
            return props;
            static ICalculatorProperties ReadMessage(Message message)
            {
                var reader = message.GetBodyReader();
                return CalculatorProperties.ReadFrom(ref reader, withInvalidated: false);
            }
        }
        public ValueTask<IDisposable> WatchPropertiesChangedAsync(Action<Exception?, ICalculatorProperties> handler, bool emitOnCapturedContext = true, ObserverFlags flags = ObserverFlags.None)
        {
            return Connection.WatchPropertiesChangedAsync(Destination, Path, DBusInterfaceName, (Message m, object? s) => ReadMessage(m), handler, this, emitOnCapturedContext, flags);
            static ICalculatorProperties ReadMessage(Message message)
            {
                var reader = message.GetBodyReader();
                reader.ReadString(); // interface
                return CalculatorProperties.ReadFrom(ref reader, withInvalidated: true);
            }
        }
        private MessageBuffer CreateGetPropertyMessage(string property)
        {
            var writer = Connection.GetMessageWriter();
            writer.WriteMethodCallHeader(
                destination: Destination,
                path: Path,
                @interface: "org.freedesktop.DBus.Properties",
                signature: "ss",
                member: "Get");
            writer.WriteString(DBusInterfaceName);
            writer.WriteString(property);
            return writer.CreateMessage();
        }
        private MessageBuffer CreateGetAllPropertiesMessage()
        {
            var writer = Connection.GetMessageWriter();
            writer.WriteMethodCallHeader(
                destination: Destination,
                path: Path,
                @interface: "org.freedesktop.DBus.Properties",
                signature: "s",
                member: "GetAll");
            writer.WriteString(DBusInterfaceName);
            return writer.CreateMessage();
        }
    }
    interface ISettingsProperties
    {
        string? Theme { get; }
        string? Language { get; }
        bool HasThemeChanged { get; }
        bool HasLanguageChanged { get; }
        bool AreAllPropertiesSet();
        SettingsProperties EnsureAllPropertiesSet();
    }
    sealed class SettingsProperties : ISettingsProperties
    {
        private uint __set;
        private uint __invalidated;
        private const uint PropertiesAllSet = 0x3U; // 2 properties
        private static uint Flag(SettingsProperty property) => property == 0 ? 0 : 1U << ((int)property - 1);
        public SettingsProperties() { }
        #nullable disable
        [System.Diagnostics.CodeAnalysis.SetsRequiredMembers]
        private SettingsProperties(bool _) { }
        #nullable enable
        private void EnsureSet(SettingsProperty property)
        {
            if (!HasFlag(__set, property))
            {
                throw new InvalidOperationException("Property is not set.");
            }
        }
        private string _theme = default!;
        public required string Theme
        {
            get { EnsureSet(SettingsProperty.Theme); return _theme; }
            set { _theme = value; __set |= Flag(SettingsProperty.Theme); }
        }
        private string _language = default!;
        public required string Language
        {
            get { EnsureSet(SettingsProperty.Language); return _language; }
            set { _language = value; __set |= Flag(SettingsProperty.Language); }
        }
        string? ISettingsProperties.Theme
            => IsSet(SettingsProperty.Theme) ? _theme : default(string?);
        string? ISettingsProperties.Language
            => IsSet(SettingsProperty.Language) ? _language : default(string?);
        bool ISettingsProperties.HasThemeChanged
            => IsSet(SettingsProperty.Theme) || IsInvalidated(SettingsProperty.Theme);
        bool ISettingsProperties.HasLanguageChanged
            => IsSet(SettingsProperty.Language) || IsInvalidated(SettingsProperty.Language);
        SettingsProperties ISettingsProperties.EnsureAllPropertiesSet()
        {
            EnsureAllPropertiesSet();
            return this;
        }
        public static SettingsProperties CreateUninitialized() => new SettingsProperties(false);
        private bool HasFlag(uint flags, SettingsProperty property)
            => property != 0 && (flags & Flag(property)) != 0;
        [System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.AggressiveInlining)]
        private static SettingsProperty ParsePropertyName(string propertyName)
        {
            return propertyName switch
            {
                "Theme" => SettingsProperty.Theme,
                "Language" => SettingsProperty.Language,
                _ => 0
            };
        }
        private bool IsSet(SettingsProperty property) => HasFlag(__set, property);
        private bool IsInvalidated(SettingsProperty property) => HasFlag(__invalidated, property);
        private void SetInvalidated(SettingsProperty property)
        {
            if (property != 0)
            {
                __invalidated |= Flag(property);
            }
        }
        [System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.AggressiveInlining)]
        public void SetInvalidated(string propertyName) => SetInvalidated(ParsePropertyName(propertyName));
        public bool AreAllPropertiesSet() => __set == PropertiesAllSet;
        public void EnsureAllPropertiesSet()
        {
            if (!AreAllPropertiesSet())
            {
                throw new DBusUnexpectedValueException($"Not all properties have been set (0x{__set:x}).");
            }
        }
        public static ISettingsProperties ReadFrom(ref Reader reader, bool withInvalidated)
        {
            var props = CreateUninitialized();
            ArrayEnd arrayEnd = reader.ReadArrayStart(DBusType.Struct);
            while (reader.HasNext(arrayEnd))
            {
                var property = reader.ReadString();
                switch (property)
                {
                    case "Theme":
                        reader.ReadSignature("s"u8);
                        props.Theme = reader.ReadString();
                        break;
                    case "Language":
                        reader.ReadSignature("s"u8);
                        props.Language = reader.ReadString();
                        break;
                    default:
                        reader.ReadVariantValue();
                        break;
                }
            }
            if (withInvalidated)
            {
                ArrayEnd invalidatedEnd = reader.ReadArrayStart(DBusType.String);
                while (reader.HasNext(invalidatedEnd))
                {
                    var propertyName = reader.ReadString();
                    props.__invalidated |= propertyName switch
                    {
                        "Theme" => Flag(SettingsProperty.Theme),
                        "Language" => Flag(SettingsProperty.Language),
                        _ => 0
                    };
                }
            }
            return props;
        }
        private enum SettingsProperty
        {
            UnknownProperty = 0,
            Theme = 1,
            Language = 2
        }
    }
    sealed partial class Settings : Tmds.DBus.Protocol.DBusObject
    {
        public const string DBusInterfaceName = "org.example.Settings";
        public Settings(Tmds.DBus.Protocol.DBusConnection connection, string destination, ObjectPath path)
            : base(connection, destination, path)
        { }
        public Task SaveAsync()
        {
            return Connection.CallMethodAsync(CreateMessage());
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: DBusInterfaceName,
                    member: "Save");
                return writer.CreateMessage();
            }
        }
        public ValueTask<IDisposable> WatchChangedAsync(Action<Exception?> handler, bool emitOnCapturedContext = true, ObserverFlags flags = ObserverFlags.None)
            => Connection.WatchSignalAsync(Destination, Path, DBusInterfaceName, "Changed", handler, this, emitOnCapturedContext, flags);
        public Task SetVolumeAsync(double value)
        {
            return Connection.CallMethodAsync(CreateMessage());
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: "org.freedesktop.DBus.Properties",
                    signature: "ssv",
                    member: "Set");
                writer.WriteString(DBusInterfaceName);
                writer.WriteString("Volume");
                writer.WriteSignature("d");
                writer.WriteDouble(value);
                return writer.CreateMessage();
            }
        }
        public Task SetLanguageAsync(string value)
        {
            return Connection.CallMethodAsync(CreateMessage());
            MessageBuffer CreateMessage()
            {
                var writer = Connection.GetMessageWriter();
                writer.WriteMethodCallHeader(
                    destination: Destination,
                    path: Path,
                    @interface: "org.freedesktop.DBus.Properties",
                    signature: "ssv",
                    member: "Set");
                writer.WriteString(DBusInterfaceName);
                writer.WriteString("Language");
                writer.WriteSignature("s");
                writer.WriteString(value);
                return writer.CreateMessage();
            }
        }
        public Task<string> GetThemeAsync()
            => Connection.CallMethodAsync(CreateGetPropertyMessage("Theme"), (Message m, object? s) => MessageReader.Read_v_s(m), this);
        public Task<string> GetLanguageAsync()
            => Connection.CallMethodAsync(CreateGetPropertyMessage("Language"), (Message m, object? s) => MessageReader.Read_v_s(m), this);
        public async Task<ISettingsProperties> GetPropertiesAsync()
        {
            var props = await Connection.CallMethodAsync(CreateGetAllPropertiesMessage(), (Message m, object? s) => ReadMessage(m), this).ConfigureAwait(false);
            props.EnsureAllPropertiesSet();
            return props;
            static ISettingsProperties ReadMessage(Message message)
            {
                var reader = message.GetBodyReader();
                return SettingsProperties.ReadFrom(ref reader, withInvalidated: false);
            }
        }
        public ValueTask<IDisposable> WatchPropertiesChangedAsync(Action<Exception?, ISettingsProperties> handler, bool emitOnCapturedContext = true, ObserverFlags flags = ObserverFlags.None)
        {
            return Connection.WatchPropertiesChangedAsync(Destination, Path, DBusInterfaceName, (Message m, object? s) => ReadMessage(m), handler, this, emitOnCapturedContext, flags);
            static ISettingsProperties ReadMessage(Message message)
            {
                var reader = message.GetBodyReader();
                reader.ReadString(); // interface
                return SettingsProperties.ReadFrom(ref reader, withInvalidated: true);
            }
        }
        private MessageBuffer CreateGetPropertyMessage(string property)
        {
            var writer = Connection.GetMessageWriter();
            writer.WriteMethodCallHeader(
                destination: Destination,
                path: Path,
                @interface: "org.freedesktop.DBus.Properties",
                signature: "ss",
                member: "Get");
            writer.WriteString(DBusInterfaceName);
            writer.WriteString(property);
            return writer.CreateMessage();
        }
        private MessageBuffer CreateGetAllPropertiesMessage()
        {
            var writer = Connection.GetMessageWriter();
            writer.WriteMethodCallHeader(
                destination: Destination,
                path: Path,
                @interface: "org.freedesktop.DBus.Properties",
                signature: "s",
                member: "GetAll");
            writer.WriteString(DBusInterfaceName);
            return writer.CreateMessage();
        }
    }
    sealed partial class Marker : Tmds.DBus.Protocol.DBusObject
    {
        public const string DBusInterfaceName = "org.example.Marker";
        public Marker(Tmds.DBus.Protocol.DBusConnection connection, string destination, ObjectPath path)
            : base(connection, destination, path)
        { }
    }
    static partial class ObjectFactory
    {
        public static Calculator CreateCalculator(this DBusService service, ObjectPath path) => new Calculator(service.Connection, service.Name, path);
        public static Settings CreateSettings(this DBusService service, ObjectPath path) => new Settings(service.Connection, service.Name, path);
        public static Marker CreateMarker(this DBusService service, ObjectPath path) => new Marker(service.Connection, service.Name, path);
    }
    file static class MessageReader
    {
        public static double Read_d(Message message)
        {
            var reader = message.GetBodyReader();
            return reader.ReadDouble();
        }
        public static (uint, double) Read_ud(Message message)
        {
            var reader = message.GetBodyReader();
            var arg0 = reader.ReadUInt32();
            var arg1 = reader.ReadDouble();
            return (arg0, arg1);
        }
        public static (int, int) Read_ii(Message message)
        {
            var reader = message.GetBodyReader();
            var arg0 = reader.ReadInt32();
            var arg1 = reader.ReadInt32();
            return (arg0, arg1);
        }
        public static (bool, double) Read_bd(Message message)
        {
            var reader = message.GetBodyReader();
            var arg0 = reader.ReadBool();
            var arg1 = reader.ReadDouble();
            return (arg0, arg1);
        }
        public static string Read_s(Message message)
        {
            var reader = message.GetBodyReader();
            return reader.ReadString();
        }
        public static (string, double) Read_sd(Message message)
        {
            var reader = message.GetBodyReader();
            var arg0 = reader.ReadString();
            var arg1 = reader.ReadDouble();
            return (arg0, arg1);
        }
        public static double Read_v_d(Message message)
        {
            var reader = message.GetBodyReader();
            reader.ReadSignature("d"u8);
            return reader.ReadDouble();
        }
        public static ObjectPath Read_v_o(Message message)
        {
            var reader = message.GetBodyReader();
            reader.ReadSignature("o"u8);
            return reader.ReadObjectPath();
        }
        public static string Read_v_s(Message message)
        {
            var reader = message.GetBodyReader();
            reader.ReadSignature("s"u8);
            return reader.ReadString();
        }
    }
    file static class MessageWriterExtensions
    {
    }
}
